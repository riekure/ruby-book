# 1. 電話番号を探す

[Rubular](https://rubular.com/)

```
名前：伊藤淳一
電話1：03-1234-5678
住所：兵庫県西脇市板波町1-2-3
電話2：03-1234-5678
```

```
\d\d-\d\d\d\d-\d\d\d\d
```

```ruby
text = <<-TEXT
名前：伊藤淳一
電話：03-1234-5678
住所：兵庫県西脇市板波町1-2-3
TEXT
p text.scan /\d\d-\d\d\d\d-\d\d\d\d/

# => ["03-1234-5678", "03-1234-5678"]
```

\dは「1個の半角数字」
\d\dは「2個の半角数字」という意味。

# 2. いろんな市街局番に対応させる

```
名前：伊藤淳一
電話：03-1234-5678
電話：090-1234-5678
電話：0795-12-3456
電話：04992-1-2345
住所：兵庫県西脇市板波町1-2-3
```

```
\d{2,5}-\d{1,4}-\d{4}
```

```ruby
text = <<-TEXT
名前：伊藤淳一
電話：03-1234-5678
電話：090-1234-5678
電話：0795-12-3456
電話：04992-1-2345
住所：兵庫県西脇市板波町1-2-3
TEXT
p text.scan /\d{2,5}-\d{1,4}-\d{4}/

# => ["03-1234-5678", "090-1234-5678", "0795-12-3456", "04992-1-2345"]
```

{n,m}は「直前の文字がn個以上、m個以下という意味。
{n}とすれば、「ちょうどn文字」という意味。

# 3. ハイフンだけでなく、カッコにも対応させる

```
名前：伊藤淳一
電話：03(1234)5678
電話：090-1234-5678
電話：0795(12)3456
電話：04992-1-2345
電話：9999-99-9999
住所：兵庫県西脇市板波町1-2-3
```

```
\d{2,5}[(-]\d{1,4}[)-]\d{4}
```

[ABC]とすれば、「AまたはBまたはCのいずれか1文字」という意味。
[a-z]とすれば、「aまたはbまたはcまたは・・・z」という意味。
[0-9]とすれば、「0または1または2または・・・9」という意味。

# 4. 電話番号の1文字目はゼロ、2文字目はゼロ以外の半角数字

```
0[1-9]\d{0,3}[(-]\d{1,4}[)-]\d{4}
```

```ruby
text = <<-TEXT
名前：伊藤淳一
電話：03-1234-5678
電話：090-1234-5678
電話：0795-12-3456
電話：04992-1-2345
住所：兵庫県西脇市板波町1-2-3
TEXT
p text.scan /0[1-9]\d{0,3}[(-]\d{1,4}[)-]\d{4}/
```

# 5. カタカナ語の表記ゆれを許容する

```
クープバゲットのパンは美味しかった。
今日はクープ バゲットさんに行きました。
クープ　バゲットのパンは最高。
ジャムおじさんのパン、ジャムが入ってた。
また行きたいです。クープ・バゲット。
クープ・バケットのパン、売り切れだった（><）
```

## 様々な区切り文字を許容する

```
クープ[ 　・]バゲット
```

## 濁点の有無を許容する

```
クープ[ 　・]バ[ケゲ]ット
```

## 区切り文字の有無を許容する

```
クープ[ 　・]?バ[ケゲ]ット
```

「～が1文字、またはなし」を表現するためには？というメタ文字を使用する

## 区切り文字を簡易的に表現する

```
クープ.?バ[ケゲ]ット
```

「任意の1文字」を表す.というメタ文字を使用する

```ruby
text = <<-TEXT
クープバゲットのパンは美味しかった。
今日はクープ バゲットさんに行きました。
クープ　バゲットのパンは最高。
ジャムおじさんのパン、ジャムが入ってた。
また行きたいです。クープ・バゲット。
クープ・バケットのパン、売り切れだった（><）
TEXT

text.split(/\n/).grep(/クープ.?バ[ゲケ]ット/)
# => ["クープバゲットのパンは美味しかった。", "今日はクープ バゲットさんに行きました。", "クープ　バゲットのパンは最高。", "また行きたいです。クープ・バゲット。", "クープ・バケットのパン、売り切れだった（><）"]
```

# 6. HTMLタグをCSVに変換する

```
<select name="game_console">
<option value="wii_u">Wii U</option>
<option value="ps4">プレステ4</option>
<option value="gb">ゲームボーイ</option>
</select>
```

## 6.1 valueを抜き出す正規表現を考える

「value=、ダブルクオート、英数字またはアンダースコアが1文字以上、ダブルクオート」
アスタリスクは、直前の文字を0回以上の繰り返しを表現
プラスは、直前の文字を1回以上の繰り返しを表現

```
value="[a-z0-9_]+"
```

## 6.2 表示テキストを抜き出す正規表現を考える

「何かしらの文字が続く」は、```.```と```*```で実現できる

```
>.+<
```

## 6.3 行全体にマッチする正規表現を作る

optionの各行全体がマッチする正規表現

```
<option value="[0-9a-z_]+">.+<\/option>
```

valueと表示テキストを```()```で囲む

```
<option value="([0-9a-z_]+)">(.+)<\/option>
```

```
Match 1
1.  wii_u
2.  Wii U
Match 2
1.  ps4
2.  プレステ4
Match 3
1.  gb
2.  ゲームボーイ
```

## 6.4 キャプチャを利用して新しい文字列を組み立てる

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/233011/aba433e9-59de-8957-4a6b-369f6d5dd6ce.png)

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/233011/debcb11f-a711-4c45-d2de-be10276b5214.png)

```
<option value="([0-9a-z_]+)">(.+)<\/option>
$1,$2
```

## 6.5 表示テキストがないoptionも置換できるようになる

```
<select name="game_console">
<option value="none"></option>
<option value="wii_u">Wii U</option>
<option value="ps4">プレステ4</option>
<option value="gb">ゲームボーイ</option>
</select>
```

```+```を```*```に変更して、「直前の文字が0文字以上」を表す

```
<option value="([0-9a-z_]*)">(.*)<\/option>
```

## 6.6 selectedになっているoptionも置換できるようにする

「"selected"があり、またはなし」というOR条件を追加する

```
<select name="game_console">
<option value="none"></option>
<option value="wii_u" selected>Wii U</option>
<option value="ps4">プレステ4</option>
<option value="gb">ゲームボーイ</option>
</select>
```

```
<option value="([0-9a-z_]*)"( selected)?>(.*)<\/option>
```

```
Match 1
1.	none
2.	 
3.	 
Match 2
1.	wii_u
2.	selected
3.	Wii U
Match 3
1.	ps4
2.	 
3.	プレステ4
Match 4
1.	gb
2.	 
3.	ゲームボーイ
```

( selected)?の部分もキャプチャされて1,2,3になっていることが問題。
キャプチャする必要がない```()```は```(?:)```とすると、キャプチャ対象から除外できる

```
<option value="([0-9a-z_]*)"(?: selected)?>(.*)<\/option>
```

こうすれば、キャプチャできる文字列が2個に戻る

```
Match 1
1.	none
2.	 
Match 2
1.	wii_u
2.	Wii U
Match 3
1.	ps4
2.	プレステ4
Match 4
1.	gb
2.	ゲームボーイ
```

## 6.7 [0-9]を\dに置き換える

```[a-z0-9_]+``` は ```[a-z\d_]+``` に置き換えることができる

```
<option value="([a-z\d_]*)"(?: selected)?>(.*)<\/option>
```

## 6.8 [a-z\d_]を\wに置き換える

```
<option value="(\w*)"(?: selected)?>(.*)<\/option>
```

```ruby
html = <<-HTML
<select name="game_console">
<option value="none"></option>
<option value="wii_u" selected>Wii U</option>
<option value="ps4">プレステ4</option>
<option value="gb">ゲームボーイ</option>
</select>
HTML

replaced = html.gsub(/<option value="(\w+)"(?: selected)?>(.*)<\/option>/, '\1,\2')

puts replaced
# <select name="game_console">
# none,
# wii_u,Wii U
# ps4,プレステ4
# gb,ゲームボーイ
# </select>
```

「> で始まり、任意の文字が0個以上連続し（.*）、< で終わる」という意味。


